# Mac Settings Management

This directory contains tools for collecting, managing, and applying your Mac's system preferences and application settings.

## Overview

The Mac settings management system consists of several components:

- **Collection Script**: `../bin/collect_mac_settings.sh` - Collects all your Mac settings from plists
- **Application Script**: `../bin/apply_mac_settings.sh` - Applies collected settings to a Mac
- **Defaults Database**: `apple_defaults.json` - Contains Apple's default values for filtering
- **Master List**: `masterlist.json` - Your personalized settings (generated by collection script)

## Quick Start

### 1. Collect Your Settings

Run the collection script on your Mac to gather all your personalized settings:

```bash
cd ~/.dotfiles
./bin/collect_mac_settings.sh
```

This will:
- Scan all plist files in standard locations
- Export settings for 100+ Mac applications and system preferences
- Filter out Apple's default values
- Create `preferences/masterlist.json` with only your custom settings

### 2. Apply Settings to Another Mac

To apply your settings to a new Mac:

```bash
cd ~/.dotfiles
./bin/apply_mac_settings.sh --dry-run  # Preview changes first
./bin/apply_mac_settings.sh            # Actually apply settings
```

## Files Explained

### `masterlist.json`

This is the main output file containing your personalized settings. It follows this structure:

```json
{
  "com.apple.finder": {
    "ShowPathbar": true,
    "ShowStatusBar": true,
    "AppleShowAllFiles": true
  },
  "com.apple.dock": {
    "tilesize": 32,
    "autohide": true
  }
}
```

Only settings that differ from Apple's defaults are included.

### `apple_defaults.json`

This database contains Apple's default values for common settings. It's used to filter out unchanged settings from your collection. You can expand this file to improve filtering accuracy.

### Collection Process

The collection script:

1. **Discovers Applications**: Scans predefined list + `~/Library/Preferences/`
2. **Exports Plists**: Uses `defaults export` to get current settings
3. **Converts to JSON**: Processes plist data into readable JSON format
4. **Filters Defaults**: Removes settings that match Apple's defaults
5. **Creates Masterlist**: Saves only your customizations

### Application Process

The application script:

1. **Reads Masterlist**: Parses your `masterlist.json`
2. **Applies Settings**: Uses `defaults write` commands for each setting
3. **Handles Data Types**: Properly converts JSON to appropriate plist types
4. **Restarts Services**: Refreshes Dock, Finder, etc. to apply changes

## Supported Applications

The system automatically detects and processes settings for:

### System Preferences
- Finder, Dock, Spotlight, Screen Capture
- Keyboard, Mouse, Trackpad settings
- Login Window, Screen Saver, Universal Access
- Menu Bar extras (Clock, Battery, etc.)

### Built-in Applications
- Safari, Mail, TextEdit, Terminal, Preview
- Calendar, Contacts, Notes, Reminders
- Music, TV, Photos, Maps, FaceTime, Messages

### Third-party Applications
- Chrome, Firefox, VSCode, Xcode
- Slack, Spotify, Docker, 1Password
- Dropbox, VLC, iTerm2, and many more

## Advanced Usage

### Selective Application

To apply only specific domains:

```bash
# Edit masterlist.json to include only desired domains
./bin/apply_mac_settings.sh
```

### Custom Defaults Database

Expand `apple_defaults.json` to improve filtering:

```json
{
  "com.yourapp.name": {
    "SettingName": "DefaultValue",
    "AnotherSetting": false
  }
}
```

### Backup and Versioning

```bash
# Create timestamped backup
cp preferences/masterlist.json preferences/masterlist-$(date +%Y%m%d).json

# Track changes with git
git add preferences/masterlist.json
git commit -m "Update Mac settings $(date)"
```

## Use Cases

### üîÑ **New Mac Setup**
Quickly configure a new Mac with all your personalized settings.

### üíæ **Settings Backup**
Create a portable backup of all your Mac customizations.

### üîç **Settings Audit**
See exactly what you've changed from Apple's defaults.

### üì± **Multiple Macs**
Keep settings synchronized across multiple machines.

### üïê **Time Travel**
Revert to previous setting configurations using git history.

## Troubleshooting

### Permission Issues
Some settings may require System Preferences to be closed:
```bash
killall "System Preferences"
./bin/apply_mac_settings.sh
```

### Settings Not Applying
Try restarting the affected application or logging out/in.

### Missing Settings
Add new applications to the `DOMAINS` array in `collect_mac_settings.sh`.

## Safety Features

- **Dry Run Mode**: Preview changes with `--dry-run`
- **Backup Creation**: Scripts preserve existing settings
- **Selective Application**: Edit masterlist to apply only specific settings
- **Error Handling**: Scripts continue even if individual settings fail

## Contributing

To improve the defaults database:

1. Research Apple's default values for new applications
2. Add them to `apple_defaults.json`
3. Test the filtering accuracy
4. Submit improvements back to the repository

## Notes

- Some settings may require admin privileges
- System Integrity Protection (SIP) may prevent certain modifications
- Always test on a non-critical system first
- Some changes require a restart to take full effect

---

*This system helps you maintain consistent, personalized Mac configurations across all your machines while keeping your dotfiles repository clean and focused.*